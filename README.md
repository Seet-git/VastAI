
# Guide run code VastAI

---

## Step 0: Add an SSH Interpreter

1. Open **PyCharm**.
2. Navigate to **File > Settings > Project: <Project Name> > Python Interpreter**.
3. Click **Add Interpreter** (the `+` icon).
4. Select **SSH Interpreter**.
5. Configure the connection settings:
   - **Host**: The IP address of your VastAI instance.
   - **Username**: `vast`.
   - **Authentication**: The user of your VastAI instance (default: `root`).
6. Test the connection and click on next.
7. Set the remote Conda environment path:
   - **Remote path**: `workspace/<project_name>`
   - In the configuration window, uncheck **Automatically synchronize files**.


## Step 1: Deployment - Disable Automatic Synchronization

1. Navigate to **File > Settings > Deployment**.
2. Select the deployment configuration associated with your project.
3. Go to the **Options** tab.
4. Change the setting **Upload changed files automatically to the default server** to **Never**.

---

## Step 2: Configure External Tools

Follow these steps to set up **External Tools** in PyCharm for syncing files to your VastAI instance:

1. Go to **File > Settings > Tools > External Tools**.
2. Click the **`+`** icon to add a new tool.
3. Fill in the fields as follows:
   - **Name**: `Sync to VastAI` (This is the display name for the tool.)
   - **Group**: `External Tools` (This keeps the tool under the External Tools menu.)
   
4. **Tool Settings**:
   - **Program**: `rsync`
     This is the program that will perform the file synchronization. Ensure `rsync` is installed on your system.
   - **Arguments**:
     ```
     -avz --delete -e "ssh -p <your-vastai-port>" $ProjectFileDir$ root@<your-vastai-ip>:/workspace/
     ```
     Replace `<your-vastai-ip>` with the IP address of your VastAI instance (e.g., `23.227.184.227`).
     Replace `<your-vastai-port>` with the port of your VastAI instance (e.g., `12345`).
     
   - **Working Directory**: `$ProjectFileDir$`
     This ensures the command is executed from the project's root directory.

5. **Advanced Options**:
   - Check **Synchronize files after execution** to ensure the project structure is updated in PyCharm after running the tool.
   - Check **Open console for tool output** to view the logs or errors of the `rsync` command in PyCharm's console.

6. Click **OK** to save the tool.
---

## Step 3: Start ngrok

1. In your local terminal, run the following command to open a tunnel to MySQL:
   ```bash
   ngrok tcp 3306
   ```
---

## Step 4: Update `config.py`

1. Open the `config.py` file in your project.
2. Update the port with the one generated by ngrok - e.g(`6.tcp.ngrok.io:12846`): 
   ```python
   ENDPOINT = "<your_ngrok_port>"
   ``` 
---

## Step 5: Synchronize the Project to VastAI

Go to **Tools > External Tools > Sync to VastAI**.

---

---

## Step 6: Install Dependencies

1. Open PyCharmâ€™s integrated terminal.
2. Click the dropdown arrow at the top of the terminal.
3. Select the interpreter associated with VastAI.

4. Run the following command to install the required dependencies:
   ```bash
   pip install -r requirements.txt
   ```
5. Log in to your **WandB** account:
   ```bash
   wandb login
   ```

---

## Step 7: Run the Current File

Click **Run Current File** or press **Shift + F10**.

---

## Step 8: Start the Optuna Dashboard

1. Open a new terminal and execute the following command to start the **Optuna** dashboard:
   ```bash
   optuna-dashboard "mysql+pymysql://optuna_user:your_password@localhost:3306/optuna_db" --port 8081
   ```
2. Access the dashboard in your browser at:
   ```
   http://localhost:8081
   ```

---

## Step 9: Enjoy! ðŸŽ‰

You are now ready to use your project on VastAI with a complete setup:
- **Remote environment managed via PyCharm.**
- **Hyperparameter optimization with Optuna.**
- **Real-time metric tracking with WandB.**


